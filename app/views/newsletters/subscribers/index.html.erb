<div class="flex items-center justify-between gap-2">
  <h2 class="text-xl font-medium">Subscribers</h2>
  <div class="space-x-1" data-controller="modal" data-action="click->modal#backdropClose">
    <button class="font-sans text-sm btn btn-secondary" data-action="modal#open">
      Import Subscribers
    </button>
    <%= link_to export_subscribers_path(@newsletter.slug), class: "font-sans text-sm btn btn-secondary" do %>
      Export to CSV
    <% end %>
    <dialog
      data-modal-target="modal"
      class="p-6 pt-5 pb-7 bg-white overflow-hidden rounded-lg shadow-with-inset min-w-sm w-96 gap-4 space-y-4"
    >
      <h2 class="text-xl font-medium">Import Subscribers</h2>
      <p class="font-sans text-sm text-stone-500">
        Upload a CSV file to import subscribers. The first row must be headers.
        Required column: <code class="bg-stone-100 px-1 rounded">email</code>.
        Optional: <code class="bg-stone-100 px-1 rounded">full_name</code>,
        <code class="bg-stone-100 px-1 rounded">labels</code> (semicolon-separated).
        Existing subscribers are skipped.
      </p>
      <%= form_with url: import_subscribers_path(@newsletter.slug), method: :post, multipart: true, local: true do |f| %>
        <div class="space-y-4">
          <%= f.file_field :file, accept: ".csv", class: "block w-full font-sans text-sm text-stone-700 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-sans file:bg-stone-100 file:text-stone-700 hover:file:bg-stone-200" %>
          <div class="flex gap-2 justify-end">
            <button type="button" class="btn btn-secondary text-sm font-sans" data-action="modal#close">Cancel</button>
            <%= f.submit "Import", class: "btn btn-primary text-sm font-sans" %>
          </div>
        </div>
      <% end %>
    </dialog>
  </div>
</div>

<div class="grid gap-2 mt-5 md:grid-cols-3">
  <%= link_to subscribers_path(@newsletter.slug), class: "px-4 py-2 space-y-2 rounded-md #{params['status'] == 'verified' || params['status'].nil? ? 'bg-stone-100 shadow-sm' : 'opacity-80'}" do %>
    <div class="font-sans text-xs font-medium tracking-widest uppercase text-stone-500">
      Verified Subscribers
    </div>
    <div class="text-3xl font-medium text-stone-900"><%= @newsletter.subscribers.verified.count %></div>
  <% end %>

  <%= link_to subscribers_path(@newsletter.slug, status: :unverified), class: "px-4 py-2 space-y-2 rounded-md #{params['status'] == 'unverified' ? 'bg-stone-100 shadow-sm' : 'opacity-80'}" do %>
    <div class="font-sans text-xs font-medium tracking-widest uppercase text-stone-500">
      Unverified Subscribers
    </div>
    <div class="text-3xl font-medium text-stone-900"><%= @newsletter.subscribers.unverified.count %></div>
  <% end %>

  <%= link_to subscribers_path(@newsletter.slug, status: :unsubscribed), class: "px-4 py-2 space-y-2 rounded-md #{params['status'] == 'unsubscribed' ? 'bg-stone-100 shadow-sm' : 'opacity-80'}" do %>
    <div class="font-sans text-xs font-medium tracking-widest uppercase text-stone-500">
      Unsubscribed
    </div>
    <div class="text-3xl font-medium text-stone-900"><%= @newsletter.subscribers.unsubscribed.count %></div>
  <% end %>
</div>

<% if @subscribers.empty? %>
  <div class="h-full py-20 mt-6 border border-dashed rounded-md border-stone-300">
    <p class="text-center text-stone-500">No subscribers found</p>
  </div>
<% else %>
  <section class="mt-6 divide-y divide-stone-200/60">
    <div
      class="
        grid grid-cols-10 py-4 font-sans text-xs font-medium tracking-widest uppercase
        text-stone-500
      "
    >
      <div class="col-span-3">
        Name
      </div>

      <div class="col-span-3">
        Email
      </div>

      <div class="col-span-2 text-right">
        <% if params['status'] == 'unsubscribed' %>
          Unsubscribed on
        <% elsif params['status'] == 'verified' || params['status'].nil? %>
          Verified on
        <% elsif params['status'] == 'unverified' %>
          Signed up on
        <% end %>
      </div>

      <div class="col-span-2 text-right">
        Created on
      </div>
    </div>
    <%= render partial: "subscribers/card",
    collection: @subscribers,
    as: :subscriber,
    cached: true %>
  </section>
  <div class="flex items-center justify-end mt-4"><%== pagy_nav @pagy, id: "pagy-nav", aria_label: "Pagination" %></div>
<% end %>
